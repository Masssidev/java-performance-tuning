# 어떤 화면이 많이 쓰이는지 알고 싶다
모니터링 툴이 없는 상황에서 어떤 화면이 많이 호출되었는지를 확인하는 것은 쉽지 않다. 하지만 웹 서버만 있다면 웹 로그를 사용하여 시스템을 분석하면 된다.
상용 툴을 이용하여 분석하는 방법도 있지만, 무료 툴을 사용해도 시스템을 분석하는 데는 큰 지장이 없다.
<hr/>

### 웹 로그
서버에 어떤 사용자가 어떤 요청을 하였고, 결과는 어떠한지 파일에 한 줄씩 쌓아준다. 한 화면을 구성하는 이미지, CSS, 자바스크립트, 플래시 파일 등 
모든 파일에 대한 요청의 결과가 이 로그 파일에 쌓인다.

아파치 웹 서버의 로그 설정 - httpd.conf 파일 로그 포맷 부분
```
LogFormat "%h %l %u %t \"%r\" %>s %b" common
```
로그
```
127.0.0.1 - - [22/Oct/20XX:14:04:43 +0900] "GET /a.gif HTTP/1.1" 200 2326
```
* 127.0.0.1(%h): 서버에 요청을 한 클라이언트의 IP 주소이다. 만약 HostnameLookups라는 설정값이 On이라면 IP 주소 대신 호스트 명이 명시 된다. 그러나 
이 설정은 서버를 매우 느리게 할 수 있으므로 추천할 만한 기능은 아니다. 클라이언트가 프록시 서버를 사용할 경우 클라이언트의 실제 주소가 아닌 프록시 
서버의 주소가 이 부분에 표시된다.
* -(%l): '-'로 표시되어 있기 때문에 요청한 정보가 없음을 의미한다. identd라는 사용자 인식 데몬이 클라이언트에서 동작하고 있을 경우에만 이 정보가 나타난다.
* -(%u): HTTP 인증을 통하여 확인된 문서를 요청한 사용자의 ID가 표시된다. 암호화 되지 않은 페이지이기 때문에 이 항목도 앞의 항목과 같이 보통 '?'로 표시된다.
* 22/Oct/2007:14:04:43 +0900(%t): 서버가 요청을 마친 시간이다. 즉, 웹 서버에서 해당 요청이 처리되어 종료된 시간으로 보면 된다. 앞에서부터 [날짜/
월/년:시:분:초 타임존]의 순서로 표시한다. 만약 시간 형식을 수정하고 싶다면 이 부분에서 할 수 있다.
* "GET /a.gif HTTP/1.1"("\%r\"): 클라이언트에서 요청한 Request의 정보를 나타낸다. 요청 방식(method)이 가장 처음 나타나며, 그 다음에는 요청 주소(URL)가 표시된다.
* 200(%>s): 서버에서 클라이언트로 보낸 최종 상태 코드를 의미한다. 만약 클라이언트에 해당 파일이 존재한다면 304가 표시된다.
* 2326(%b): 클라이언트로 전송한 데이터의 크기가 표시된다. 여기서 헤더 정보의 크기는 포함되지 않는다. 이 파일의 경우 이미지 파일이기 때문에 여기에 표시된 
전송 데이터의 크기와 실제 전송된 파일의 크기는 동일하다.

> 로그 포맷에 %D와 %T를 추가하면 성능에 대한 데이터도 얻을 수 있다.(%D 옵션을 권장)
* %D: 요청의 처리 시간을 마이크로초 단위로 나타낸다.
* %T: 요청의 처리 시간을 초 단위로 나타낸다.

###### 무료 웹 로그 분석 툴
* Analog (2005년 최종 업데이트)
* AWStats
* Webalizer (2010년 최종 업데이트)

> AWStats는 최근까지 업데이트된 툴이며 다음과 같은 기능들을 제공한다.
* 방문 횟수와 방문자 수
* 방문하여 페이지에 머무른 기간 및 마지막 방문일
* 각 시간 및 요일별 방문 페이지 수와 네트워크 사용량
* 방문자의 국가(GeoIP 활용)
* 가장 많이 본 페이지, 유입 경로 및 마지막 페이지
* 웹 압축 통계
* 사용 OS 및 브라우저 통계
* 방문 검색 로봇의 횟수
* 검색 엔진 및 검색 키워드
* HTTP 에러 목록
* 즐겨찾기 북마크에 추가된 횟수
* 화면 크기(이 기능을 사용하기 위해서는 초기 페이지에 HTML 태그가 추가되어야 함)
<hr/>

### 웹 로그를 통해서 접근 통계를 분석하기 싫다면...
구글에서 제공하고 있는 'Google 애널리틱스'도 웹 사용자 통계를 제공하는 막강한 무료 툴 중 하나이다. 하지만 이 툴은 웹로그 기반의 툴은 아니라, 
접근하는 모든 페이지에 정보를 전달하는 자바 스크립트 코드를 넣고 구글 서버에 데이터를 쌓는 방식이다. 그러므로, 모든 정보는 구글에 위치하기 때문에, 
개인 홈페이지가 아닌 회사의 서버에 구글 애널리틱스를 설치하면 회사의 사용량 정보가 유출될 우려가 있다. 

Piwik은 오픈소스로 제공되는 웹페이지 접근 통계 툴이며, 일반 브라우저 뿐만이 아니라 안드로이드나 아이폰 등 모바일 기기에서도 데이터를 확인할 수 있다.
* 실시간 사용량 확보
* 방문자에 대한 상세한 정보
* 변경 가능한 대시보드
* 내부 검색 엔진을 통한 검색 기능
* 방문자의 위치에 대한 세계 지도

> 이 밖에 500가지가 넘는 기능을 제공함

> 또한, 플러그인을 제공한다.

###### Piwik을 사용하기 위한 수집 서버의 기본 요건
* PHP 5.1.3 이상의 버전을 제공하는 웹서버
    * PHP의 pdo, pdo_mysql, GD 모듈 포함
* MySQL 4.1 이상

> 수집 서버를 사용할 상황이 안된다면, Piwik 개발사에서 제공하는 서버를 사용할 수도 있다. (한 달에 4달러)

###### Piwik 서버를 설치하는 절차
1. Piwik 소스 다운로드 및 압축 해제
2. 브라우저를 열어 Piwik 페이지 접근. 이제부터는 웹 페이지에서 버튼(Next)을 눌러 넘어가면 되는데, 이 때 서버의 설정 등을 변경해야 할 필요가 있다. 
그러므로, 터미널 창을 열어 권한 변경 작업을 수행해야 한다.
3. 시스템 체크(필요 모듈 및 디렉터리 권한 확인)
4. 데이터베이스 설정
5. 사용자 계정 설정(아이디와 패스워드를 지정)
6. 통계를 수집하고자 하는 웹페이지의 정보 입력
7. 통계를 수집하고자 하는 웹 페이지에 추가할 JavaScript 코드를확인하고, 해당 스크립트를 복사하여 /Body 태그 앞에 붙여 넣는다.
8. Piwik을 통한 결과 확인


